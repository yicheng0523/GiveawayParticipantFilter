<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ç¤¾ç¾¤æŠ½çéƒ¨éšŠéæ¿¾å™¨</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --text-main: #1c1e21;
            --text-sub: #606770;
            --border-color: #ccd0d5;
            --btn-run: #d32f2f;
            --stat-box-bg: #f8f9fa;
            --accent-red: #d32f2f;
            --initial-blue: #3730a3;
            --initial-bg: #e0e7ff;
            --captured-red: #991b1b;
            --captured-bg: #fee2e2;
        }

        [data-theme="dark"] {
            --bg-color: #18191a;
            --card-bg: #242526;
            --text-main: #e4e6eb;
            --text-sub: #b0b3b8;
            --border-color: #3e4042;
            --btn-run: #e53935;
            --stat-box-bg: #1c1d1e;
            --accent-red: #ff5252;
        }

        body { font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; background-color: var(--bg-color); padding: 30px; color: var(--text-main); transition: 0.4s; min-height: 100vh; margin: 0; }
        .container { max-width: 900px; margin: auto; display: flex; flex-direction: column; gap: 20px; margin-bottom: 50px; }
        
        .section-card { background: var(--card-bg); padding: 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); transition: 0.4s; }

        .header-area { display: flex; justify-content: space-between; align-items: center; }
        h2 { color: var(--accent-red); margin: 0; letter-spacing: 2px; flex-grow: 1; text-align: center; padding-left: 40px; }
        .theme-toggle { background: var(--card-bg); border: 1px solid var(--border-color); width: 40px; height: 40px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 20px; color: var(--text-main); }

        .tool-helper { text-align: center; }
        .btn-group { display: flex; justify-content: center; gap: 12px; flex-wrap: wrap; margin-top: 15px; }
        .external-link { text-decoration: none; color: white; padding: 10px 18px; border-radius: 8px; font-weight: bold; font-size: 14px; transition: 0.2s; display: inline-block; border: none; }
        .btn-fb { background-color: #1877f2; }
        .btn-ig { background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%); }
        .btn-pay { background-color: #28a745; }

        .input-group { margin-bottom: 25px; }
        .section-title-style { font-size: 18px; font-weight: bold; border-left: 4px solid var(--accent-red); padding-left: 12px; margin: 0; display: block; margin-bottom: 12px; }
        
        textarea, .file-input-wrapper { width: 100%; box-sizing: border-box; }
        textarea { height: 100px; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-color); color: var(--text-main); font-size: 14px; resize: vertical; display: block; }
        input[type="file"] { width: 100%; padding: 12px; border: 1px dashed var(--border-color); border-radius: 8px; background: var(--bg-color); color: var(--text-main); cursor: pointer; box-sizing: border-box; display: block; }
        
        .btn-run { background: var(--btn-run); color: white; border: none; padding: 20px; width: 100%; border-radius: 12px; font-size: 22px; font-weight: bold; cursor: pointer; transition: 0.3s; box-shadow: 0 4px 15px rgba(211, 47, 47, 0.3); }
        .btn-run:hover { transform: translateY(-2px); opacity: 0.95; }

        .dashboard-section { border: 2px solid var(--border-color); }
        .dashboard-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        #status-text { font-size: 14px; color: var(--text-sub); font-weight: normal; margin-left: 10px; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 25px; }
        .stat-box { background: var(--stat-box-bg); border: 1px solid var(--border-color); padding: 15px 5px; border-radius: 10px; text-align: center; }
        .stat-box span { display: block; font-size: 12px; color: var(--text-sub); margin-bottom: 5px; }
        .stat-box strong { font-size: 36px; color: var(--accent-red); display: block; line-height: 1; }

        .list-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-top: 1px solid var(--border-color); padding-top: 20px; }
        .legend-note { font-size: 12px; color: var(--text-sub); }
        .dot { display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 4px; }
        .dot-blue { background: var(--initial-blue); }
        .dot-red { background: var(--captured-red); }

        .name-tag-container { min-height: 100px; display: flex; flex-wrap: wrap; gap: 8px; align-items: flex-start; justify-content: center; background: var(--bg-color); padding: 15px; border-radius: 8px; }
        .placeholder-text { color: var(--text-sub); font-style: italic; margin-top: 30px; }
        
        .name-tag { background: var(--captured-bg); color: var(--captured-red); padding: 4px 10px; border-radius: 20px; font-size: 12px; border: 1px solid #fecaca; opacity: 0; animation: fadeInUp 0.4s forwards; }
        .initial-tag { background: var(--initial-bg); color: var(--initial-blue); border-color: #c7d2fe; }
        
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

        .desc-section { font-size: 14px; color: var(--text-sub); line-height: 1.8; border-left: 5px solid #ffc107; background: rgba(255,193,7,0.05); }
        .footer-credit { text-align: center; color: #adb5bd; font-size: 11px; padding: 10px 0 30px 0; line-height: 1.6; }
    </style>
</head>
<body data-theme="light">

<div class="container">
    <div class="header-area">
        <h2>ç¤¾ç¾¤æŠ½çéƒ¨éšŠéæ¿¾å™¨</h2>
        <button id="themeToggle" class="theme-toggle" onclick="manualToggle()">â˜€ï¸</button>
    </div>

    <div class="section-card tool-helper">
        <p style="margin:0; font-weight:bold;">å»ºè­°ä½¿ç”¨ã€ŒæŠ½çå°å¹«æ‰‹ã€ä»˜è²»ç‰ˆå·¥å…·åŒ¯å‡ºç•™è¨€æ¸…å–®</p>
        <div class="btn-group">
            <a href="https://www.luckyhelpers.com/" target="_blank" class="external-link btn-fb">Facebook è²¼æ–‡ç•™è¨€åŒ¯å‡º</a>
            <a href="https://www.luckyhelpers.com/instagram" target="_blank" class="external-link btn-ig">Instagram è²¼æ–‡ç•™è¨€åŒ¯å‡º</a>
            <a href="https://www.luckyhelpers.com/order" target="_blank" class="external-link btn-pay">ã€ŒæŠ½çå°å¹«æ‰‹ã€ä»˜è²»é é¢</a>
        </div>
    </div>

    <div class="section-card">
        <div class="input-group">
            <label class="section-title-style">ç¶“äººå·¥æª¢æ ¸ç¢ºèªä¹‹æŠ½çéƒ¨éšŠå¸³è™Ÿ</label>
            <textarea id="nameInput" placeholder="è«‹ä»¥åŠå½¢é€—è™Ÿï¼ˆ,ï¼‰åˆ†éš”è¼¸å…¥åå–®..."></textarea>
        </div>
        <div class="input-group" style="margin-bottom:0;">
            <label class="section-title-style">ä¸Šå‚³ç•™è¨€åå–® Excel æª”</label>
            <div class="file-input-wrapper">
                <input type="file" id="fileUpload" accept=".xlsx">
            </div>
        </div>
    </div>

    <button class="btn-run" onclick="runAnalysis()">æŠ½çéƒ¨éšŠï¼ç¾å½¢å§ï¼</button>

    <div class="section-card dashboard-section">
        <div class="dashboard-header">
            <p class="section-title-style">ç³»çµ±ç‹€æ…‹ <span id="status-text">å¾…å‘½è¼¸å…¥è³‡æ–™</span></p>
        </div>
        
        <div class="stats-grid">
            <div class="stat-box"><span>åˆå§‹åå–®</span><strong id="stat-initial">0</strong></div>
            <div class="stat-box"><span>ç³»çµ±æ•ç²</span><strong id="stat-captured">0</strong></div>
            <div class="stat-box"><span>ç¸½è¨ˆäººæ•¸</span><strong id="stat-total-names">0</strong></div>
            <div class="stat-box"><span>åˆªé™¤ç­†æ•¸</span><strong id="stat-deleted">0</strong></div>
        </div>

        <div class="list-header">
            <p class="section-title-style">æŠ½çéƒ¨éšŠåå–®</p>
            <div class="legend-note">
                <span class="dot dot-blue"></span>åˆå§‹åå–® | 
                <span class="dot dot-red"></span>ç³»çµ±æ•ç²
            </div>
        </div>
        
        <div id="nameListDisplay" class="name-tag-container">
            <span class="placeholder-text">è®“æˆ‘å€‘çœ‹çœ‹ï¼ŒæŠ½çéƒ¨éšŠæœ‰èª°å‘¢ï¼Ÿ</span>
        </div>

        <div id="downloadArea" style="display:none; margin-top:20px; text-align:center;">
            <button class="external-link" style="background:#6c757d; cursor:pointer;" onclick="downloadNameListTxt()">ä¸‹è¼‰æ­¤åå†Š (.txt)</button>
        </div>
    </div>

    <div class="section-card desc-section">
        <strong>åˆ†æé‚è¼¯èªªæ˜ï¼š</strong><br>
        1. <strong>ç¨®å­æƒæï¼š</strong>ä»¥æ‚¨è¼¸å…¥çš„åå–®ç‚ºåŸºç¤ï¼Œåµæ¸¬æ‰€æœ‰æ¨™è¨˜äº†é€™äº›å¸³è™Ÿçš„ç•™è¨€è€…ã€‚<br>
        2. <strong>éè¿´æ“´æ•£ï¼š</strong>å°‡æ–°æŠ“åˆ°çš„å¸³è™Ÿè¦–ç‚ºéƒ¨éšŠæˆå“¡é‡è¤‡æƒæï¼Œç›´è‡³ç¶²è·¯å®Œæ•´æ•ç²ã€‚<br>
        3. <strong>è‡ªå‹•éæ¿¾ï¼š</strong>å¾¹åº•ç§»é™¤æ¸…å–®ä¸­å¸³è™Ÿåœ¨ Excel å…§çš„ç•™è¨€ï¼Œä¸¦ç”¢ç”Ÿä¸‹è¼‰æª”æ¡ˆã€‚
    </div>

    <div class="footer-credit">
        ç¤¾ç¾¤æŠ½çéƒ¨éšŠéæ¿¾å™¨ Ver_1.0_Beta_20251224<br>
        Vibe Coding by æ›¾ç¿Šæˆ via Google Gemini
    </div>
</div>

<script>
    let finalBotList = [];
    const body = document.body;
    const themeBtn = document.getElementById('themeToggle');

    function detectColorScheme() {
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            applyTheme('dark');
        } else {
            applyTheme('light');
        }
    }
    
    function applyTheme(theme) {
        body.setAttribute('data-theme', theme);
        themeBtn.innerText = theme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';
    }

    function manualToggle() {
        const newTheme = body.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
        applyTheme(newTheme);
    }

    detectColorScheme();

    function animateValueEaseOut(id, start, end, duration = 5000) {
        const obj = document.getElementById(id);
        if (!obj) return;
        let startTimestamp = null;
        const step = (timestamp) => {
            if (!startTimestamp) startTimestamp = timestamp;
            let progress = (timestamp - startTimestamp) / duration;
            if (progress > 1) progress = 1;
            
            const easeProgress = 1 - Math.pow(1 - progress, 3);
            const currentValue = Math.floor(easeProgress * (end - start) + start);
            
            obj.innerHTML = currentValue.toLocaleString();
            if (progress < 1) window.requestAnimationFrame(step);
        };
        window.requestAnimationFrame(step);
    }

    function runAnalysis() {
        const nameInputStr = document.getElementById('nameInput').value;
        const fileInput = document.getElementById('fileUpload');
        const statusText = document.getElementById('status-text');
        const container = document.getElementById('nameListDisplay');

        if (!nameInputStr.trim() || !fileInput.files[0]) {
            statusText.innerText = "è«‹è¼¸å…¥åˆå§‹åå–®ä¸¦é¸æ“‡æª”æ¡ˆ";
            statusText.style.color = "var(--accent-red)";
            return;
        }

        statusText.innerText = "æ­£åœ¨åŸ·è¡ŒåŒæ­¥æ•ç²èˆ‡é€£çµåˆ†æ...";
        statusText.style.color = "var(--text-sub)";
        container.innerHTML = ""; 

        const reader = new FileReader();
        reader.onload = function(e) {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, { type: 'array' });
            const rows = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]]);

            const initialNames = nameInputStr.split(',').map(n => n.trim()).filter(n => n !== "");
            let targetSet = new Set(initialNames);
            
            let hasNew = true;
            while (hasNew) {
                hasNew = false;
                const currentTargets = Array.from(targetSet);
                rows.forEach(row => {
                    const acc = String(row["å¸³è™Ÿ"] || "").trim();
                    const msg = String(row["ç•™è¨€"] || "");
                    if (!targetSet.has(acc) && currentTargets.some(t => msg.includes(t))) {
                        targetSet.add(acc);
                        hasNew = true;
                    }
                });
            }

            finalBotList = Array.from(targetSet).sort();
            const filteredRows = rows.filter(row => !targetSet.has(String(row["å¸³è™Ÿ"] || "").trim()));

            animateValueEaseOut('stat-initial', 0, initialNames.length, 5000);
            animateValueEaseOut('stat-captured', 0, targetSet.size - initialNames.length, 5000);
            animateValueEaseOut('stat-total-names', 0, targetSet.size, 5000);
            animateValueEaseOut('stat-deleted', 0, rows.length - filteredRows.length, 5000);

            const total = finalBotList.length;
            const duration = 5000;

            finalBotList.forEach((name, index) => {
                const normalizedProgress = (index + 1) / total;
                const easeProgress = 1 - Math.pow(1 - normalizedProgress, 3);
                const delay = easeProgress * duration;

                setTimeout(() => {
                    const span = document.createElement('span');
                    span.className = 'name-tag' + (initialNames.includes(name) ? ' initial-tag' : '');
                    span.innerText = name;
                    container.appendChild(span);
                }, delay);
            });

            setTimeout(() => {
                statusText.innerText = "åˆ†æå®Œç•¢ï¼ä¹¾æ·¨æª”æ¡ˆå·²åŒ¯å‡ºã€‚";
                statusText.style.color = "#28a745";
                document.getElementById('downloadArea').style.display = "block";
                const newWorkbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(newWorkbook, XLSX.utils.json_to_sheet(filteredRows), "Result");
                XLSX.writeFile(newWorkbook, "Filtered_Export.xlsx");
            }, 5200);
        };
        reader.readAsArrayBuffer(fileInput.files[0]);
    }

    function downloadNameListTxt() {
        const blob = new Blob([finalBotList.join(',')], { type: 'text/plain' });
        const a = document.createElement('a');
        a.href = window.URL.createObjectURL(blob);
        a.download = "army_list.txt";
        a.click();
    }
</script>
</body>
</html>
